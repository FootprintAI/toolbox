# Code Vulnerability Scanner Toolbox

A comprehensive vulnerability scanning solution for Go/Next.js/Python applications using Docker-based tools.

## 🔧 Tools Included

### **Trivy** - Dependency & Container Vulnerability Scanner
- **Purpose**: Scans dependencies, container images, and configurations
- **Finds**: Known CVEs in packages, container vulnerabilities, misconfigurations
- **Best for**: CI/CD pipelines, dependency audits, container security

### **Semgrep** - Static Code Analysis Scanner  
- **Purpose**: Scans source code for security vulnerabilities
- **Finds**: SQL injection, XSS, hardcoded secrets, code injection, OWASP Top 10
- **Best for**: Code reviews, security audits, finding actual code vulnerabilities

## 📁 File Structure

```
code-vulnerability-scanner/
├── README.md                    # This file
├── trivy_scanner.py            # Trivy dependency scanner
├── trivyignore-template        # Trivy ignore patterns for Go/JS/Python
├── trivy-examples.sh           # Trivy usage examples
├── semgrep_scanner.py          # Semgrep source code scanner
├── semgrep-custom-rules.yml    # Custom security rules for your stack
├── semgrep-examples.sh         # Semgrep usage examples
├── logs/                       # Scan logs
└── security-reports/           # Generated reports
```

## 🚀 Quick Start

### Trivy (Dependencies & Containers)
```bash
# Quick dependency scan
./trivy_scanner.py quick

# Scan specific repository  
./trivy_scanner.py repo /path/to/project --severity HIGH,CRITICAL

# Scan Docker image
./trivy_scanner.py image nginx:latest
```

### Semgrep (Source Code)
```bash
# Comprehensive source code scan
./semgrep_scanner.py comprehensive /path/to/project

# Security-focused scan
./semgrep_scanner.py security /path/to/project --severity ERROR

# Language-specific scan
./semgrep_scanner.py language /path/to/go-code --lang go
```

## 📊 Output & Reports

Both tools generate reports in multiple formats:
- **JSON** - For automation and CI/CD integration
- **SARIF** - For GitHub Security tab integration
- **Text/Table** - Human-readable reports

Reports are saved to: `./security-reports/`
Logs are saved to: `./logs/`

## 🎯 Use Cases

| Scenario | Tool | Command |
|----------|------|---------|
| **Pre-deployment security check** | Both | Run both comprehensive scans |
| **Dependency audit** | Trivy | `./trivy_scanner.py repo` |
| **Code review security** | Semgrep | `./semgrep_scanner.py security` |
| **Container security** | Trivy | `./trivy_scanner.py image` |
| **Find hardcoded secrets** | Semgrep | `./semgrep_scanner.py language --lang python` |
| **OWASP Top 10 check** | Semgrep | `./semgrep_scanner.py comprehensive` |

## ⚙️ Configuration

### Trivy Configuration
- **Ignore file**: `trivyignore-template` - Framework-specific ignore patterns
- **Auto-deployment**: Script creates `.trivyignore` in target directories

### Semgrep Configuration  
- **Custom rules**: `semgrep-custom-rules.yml` - Security rules for Go/JS/Python
- **Built-in rulesets**: `p/security-audit`, `p/golang`, `p/javascript`, etc.

## 🔍 What Each Tool Finds

### Trivy Detects:
✅ CVEs in npm packages  
✅ Vulnerabilities in Go modules  
✅ Python package security issues  
✅ Container image vulnerabilities  
✅ Dockerfile misconfigurations  
✅ Infrastructure as Code issues  

### Semgrep Detects:
✅ SQL injection vulnerabilities  
✅ Cross-site scripting (XSS)  
✅ Hardcoded API keys/passwords  
✅ Code injection (eval, exec)  
✅ Weak cryptography usage  
✅ Prototype pollution (JavaScript)  
✅ Unsafe deserialization  
✅ OWASP Top 10 vulnerabilities  

## 🐳 Docker Requirements

Both tools require Docker to be installed and running. They use official Docker images:
- **Trivy**: `aquasec/trivy:latest`
- **Semgrep**: `returntocorp/semgrep:latest`

## 📋 Examples

See the example scripts for detailed usage:
- `./trivy-examples.sh` - Trivy usage examples
- `./semgrep-examples.sh` - Semgrep usage examples

## 🔧 Integration

### CI/CD Integration
Both tools output SARIF format for GitHub Security tab integration:
```bash
# Generate SARIF reports for GitHub
./semgrep_scanner.py security /path/to/code --severity ERROR
./trivy_scanner.py repo /path/to/code --severity HIGH,CRITICAL
```

### Pre-commit Hooks
Add to `.pre-commit-config.yaml`:
```yaml
repos:
  - repo: local
    hooks:
      - id: security-scan
        name: Security Scan
        entry: ./code-vulnerability-scanner/semgrep_scanner.py security . --severity ERROR
        language: system
        pass_filenames: false
```

## 📈 Best Practices

1. **Run both tools** - They complement each other (dependencies + source code)
2. **Use appropriate severity levels** - ERROR for production, WARNING for development
3. **Review ignore patterns** - Customize ignore files for your specific needs
4. **Integrate into CI/CD** - Automate scanning in your pipeline
5. **Regular scanning** - Run weekly dependency scans, daily code scans